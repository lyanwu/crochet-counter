<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¯›ç·šå‹¾é‡è¨ˆæ•¸å™¨</title>
  <style>
    body {
      font-family: "Arial", sans-serif;
      background-color: #fdf6f0;
      color: #333;
      text-align: center;
      padding: 1rem;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 1rem;
    }
    .tab-button {
      padding: 0.5rem 1rem;
      margin: 0 0.5rem;
      font-size: 1rem;
      border: none;
      background-color: #f0a6ca;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    .tab-button.active {
      background-color: #e68db2;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .counter {
      margin: 1rem auto;
      padding: 1rem;
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      width: 280px;
    }
    .label {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }
    .number {
      font-size: 2rem;
      margin: 0.5rem 0;
    }
    .buttons {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .buttons button {
      margin: 0.4rem;
      padding: 1.5rem;
      font-size: 1.4rem;
      border: none;
      border-radius: 6px;
      background-color: #f0a6ca;
      color: white;
      cursor: pointer;
      width: 80%;
    }
    .buttons .row {
      display: flex;
      justify-content: center;
      gap: 1rem;
      width: 100%;
    }
    .buttons .row button {
      padding: 0.5rem;
      font-size: 1rem;
      width: 100%;
    }
    .buttons button.minus {
      background-color: #69c77f;
    }
    .buttons button.clear {
      background-color: #f44336;
    }
    .buttons button:hover {
      opacity: 0.9;
    }
    .note {
      margin-top: 1rem;
    }
    textarea {
      width: 90%;
      height: 80px;
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    select {
      margin-bottom: 1rem;
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 6px;
    }
    .menu-button {
      position: absolute;
      top: 1rem;
      left: 1rem;
      font-size: 1.5rem;
      background: none;
      border: none;
      cursor: pointer;
    }
    .menu {
      position: absolute;
      top: 3rem;
      left: 1rem;
      background: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 0.5rem;
      display: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .menu.visible {
      display: block;
    }
    .menu button {
      display: block;
      width: 100%;
      margin: 0.25rem 0;
      padding: 0.5rem;
      border: none;
      background-color: #eee;
      cursor: pointer;
      border-radius: 4px;
    }
    .note-shared {
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <h1>ğŸ§¶ æ¯›ç·šå‹¾é‡è¨ˆæ•¸å™¨</h1>

  <button class="menu-button" onclick="toggleMenu()">â˜°</button>
  <div class="menu" id="menu">
    <button onclick="addProject()">â• æ–°å¢å°ˆæ¡ˆ</button>
    <button onclick="deleteProject()">ğŸ—‘ï¸ åˆªé™¤ç•¶å‰å°ˆæ¡ˆ</button>
  </div>

  <select id="projectSelector" onchange="switchProject(this.value)"></select>

  <div class="tabs">
    <button class="tab-button active" id="roundTabButton" onclick="showTab('roundTab')">åœˆæ•¸ (0)</button>
    <button class="tab-button" id="stitchTabButton" onclick="showTab('stitchTab')">é‡æ•¸ (0)</button>
    <button class="tab-button" id="countdownTabButton" onclick="showTab('countdownTab')">å€’æ•¸é‡æ•¸ (0)</button>
  </div>

  <div id="roundTab" class="tab-content active">
    <div class="counter">
      <div class="label">åœˆæ•¸</div>
      <div id="roundCount" class="number">0</div>
      <div class="buttons">
        <button onclick="changeCount('round', 1)">+1</button>
        <div class="row">
          <button class="minus" onclick="changeCount('round', -1)">-1</button>
          <button class="clear" onclick="confirmReset('round')">æ¸…é™¤åœˆæ•¸</button>
        </div>
      </div>
    </div>
  </div>

  <div id="stitchTab" class="tab-content">
    <div class="counter">
      <div class="label">é‡æ•¸</div>
      <div id="stitchCount" class="number">0</div>
      <div class="buttons">
        <button onclick="changeCount('stitch', 1)">+1</button>
        <div class="row">
          <button class="minus" onclick="changeCount('stitch', -1)">-1</button>
          <button class="clear" onclick="confirmReset('stitch')">æ¸…é™¤é‡æ•¸</button>
        </div>
      </div>
    </div>
  </div>

  <div id="countdownTab" class="tab-content">
    <div class="counter">
      <div class="label">è¼¸å…¥ç¸½é‡æ•¸</div>
      <input id="countdownInput" type="number" min="0" inputmode="numeric" style="width: 80%; font-size: 1.2rem; margin-bottom: 0.5rem;">
      <div class="label">å‰©é¤˜é‡æ•¸</div>
      <div id="countdownRemain" class="number">0</div>
      <div class="buttons">
        <!-- åè½‰åŠŸèƒ½ï¼š-1 æœƒ+1ï¼Œ+1 æœƒ-1 -->
        <button class="minus" onclick="changeCountdown(1)">-1</button>
        <div class="row">
          <button onclick="changeCountdown(-1)">+1</button>
          <button class="clear" onclick="resetCountdown()">æ¸…é™¤é‡æ•¸</button>
        </div>
      </div>
    </div>
  </div>

  <div class="note-shared">
    <div class="label">å‚™è¨»</div>
    <textarea id="noteShared" placeholder="é€™è£¡å¯ä»¥å¯«ä¸‹å‚™è¨»..."></textarea>
  </div>

  <script>
    let roundCount = 0;
    let stitchCount = 0;
    let countdownTotal = 0;
    let countdownCount = 0;

    let projects = JSON.parse(localStorage.getItem('crochetProjects') || '{}');
    let currentProject = localStorage.getItem('currentProject') || 'é è¨­å°ˆæ¡ˆ';

    function saveProjectData() {
      projects[currentProject] = {
        round: roundCount || 0,
        stitch: stitchCount || 0,
        note: document.getElementById('noteShared')?.value || '',
        countdown: {
          total: countdownTotal || 0,
          count: countdownCount || 0
        }
      };
      localStorage.setItem('crochetProjects', JSON.stringify(projects));
      localStorage.setItem('currentProject', currentProject);
    }

    function updateTabTitles() {
      const remain = Math.max(0, countdownTotal - countdownCount);
      document.getElementById('roundTabButton').textContent = `åœˆæ•¸ (${roundCount})`;
      document.getElementById('stitchTabButton').textContent = `é‡æ•¸ (${stitchCount})`;
      document.getElementById('countdownTabButton').textContent = `å€’æ•¸é‡æ•¸ (${remain})`;
    }

    function loadProjectData() {
      const data = projects[currentProject] || {};
      roundCount = Number(data.round) || 0;
      stitchCount = Number(data.stitch) || 0;
      document.getElementById('roundCount').textContent = roundCount;
      document.getElementById('stitchCount').textContent = stitchCount;
      document.getElementById('noteShared').value = typeof data.note === 'string' ? data.note : '';

      countdownTotal = data.countdown?.total || 0;
      countdownCount = data.countdown?.count || 0;
      document.getElementById('countdownInput').value = countdownTotal || '';
      updateCountdownRemain();
      updateTabTitles();
    }

    function switchProject(name) {
      saveProjectData();
      currentProject = name;
      if (!projects[name]) projects[name] = {};
      populateProjectSelector();
      loadProjectData();
    }

    function populateProjectSelector() {
      const selector = document.getElementById('projectSelector');
      selector.innerHTML = '';
      for (let name in projects) {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        if (name === currentProject) option.selected = true;
        selector.appendChild(option);
      }
    }

    function changeCount(type, value) {
      if (type === 'round') {
        roundCount = Math.max(0, roundCount + value);
        document.getElementById('roundCount').textContent = roundCount;
      } else {
        stitchCount = Math.max(0, stitchCount + value);
        document.getElementById('stitchCount').textContent = stitchCount;
      }
      updateTabTitles();
      saveProjectData();
    }

    function confirmReset(type) {
      const label = type === 'round' ? 'åœˆæ•¸' : 'é‡æ•¸';
      if (confirm(`ä½ ç¢ºå®šè¦æ¸…é™¤${label}å—ï¼Ÿé€™å€‹å‹•ä½œç„¡æ³•é‚„åŸã€‚`)) {
        if (type === 'round') {
          roundCount = 0;
          document.getElementById('roundCount').textContent = roundCount;
        } else {
          stitchCount = 0;
          document.getElementById('stitchCount').textContent = stitchCount;
        }
        updateTabTitles();
        saveProjectData();
      }
    }

    function showTab(tabId) {
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.getElementById(tabId + 'Button')?.classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }

    function toggleMenu() {
      document.getElementById('menu').classList.toggle('visible');
    }

    function addProject() {
      const name = prompt('è«‹è¼¸å…¥æ–°å°ˆæ¡ˆåç¨±ï¼š');
      if (name && !projects[name]) {
        projects[name] = {};
        currentProject = name;
        populateProjectSelector();
        loadProjectData();
        saveProjectData();
      } else if (projects[name]) {
        alert('å°ˆæ¡ˆåç¨±å·²å­˜åœ¨ã€‚');
      }
    }

    function deleteProject() {
      if (confirm(`ä½ ç¢ºå®šè¦åˆªé™¤å°ˆæ¡ˆã€Œ${currentProject}ã€å—ï¼Ÿåˆªé™¤å¾Œç„¡æ³•æ¢å¾©ã€‚`)) {
        delete projects[currentProject];
        const keys = Object.keys(projects);
        currentProject = keys.length ? keys[0] : 'é è¨­å°ˆæ¡ˆ';
        if (!projects[currentProject]) projects[currentProject] = {};
        populateProjectSelector();
        loadProjectData();
        saveProjectData();
      }
    }

    // å€’æ•¸é‡æ•¸éƒ¨åˆ†
    function updateCountdownRemain() {
      const remain = Math.max(0, countdownTotal - countdownCount);
      document.getElementById('countdownRemain').textContent = remain;
      updateTabTitles();
      saveProjectData();
    }

    // åè½‰ï¼š-1æŒ‰éˆ•+1ï¼Œ+1æŒ‰éˆ•-1
    function changeCountdown(val) {
      if (val === 1) {
        countdownCount = Math.min(countdownTotal, countdownCount + 1);
      } else if (val === -1) {
        countdownCount = Math.max(0, countdownCount - 1);
      }
      updateCountdownRemain();
    }

    // æ¸…é™¤é‡æ•¸ï¼ç¸½é‡æ•¸èˆ‡å·²å®Œæˆéƒ½æ­¸é›¶
    function resetCountdown() {
      if (confirm('ä½ ç¢ºå®šè¦æ¸…é™¤å€’æ•¸é‡æ•¸å—ï¼Ÿé€™å€‹å‹•ä½œç„¡æ³•é‚„åŸã€‚')) {
        countdownTotal = 0;
        countdownCount = 0;
        document.getElementById('countdownInput').value = '';
        updateCountdownRemain();
      }
    }

    // åˆå§‹åŒ–
    if (!projects[currentProject]) projects[currentProject] = {};
    populateProjectSelector();
    loadProjectData();

    document.getElementById('noteShared').addEventListener('input', saveProjectData);

    // ç¶å®šå€’æ•¸é‡æ•¸ input äº‹ä»¶
    document.getElementById('countdownInput').addEventListener('input', function(e) {
      countdownTotal = Number(e.target.value) || 0;
      if (countdownCount > countdownTotal) countdownCount = countdownTotal;
      updateCountdownRemain();
    });
  </script>
</body>
</html>
